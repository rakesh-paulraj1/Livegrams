FROM node:20-slim AS base

WORKDIR /usr/src/app

COPY package.json pnpm-lock.yaml pnpm-workspace.yaml turbo.json ./

RUN npm install -g pnpm

# Install dependencies
RUN pnpm install --frozen-lockfile

# Copy source code
COPY ./packages ./packages
COPY ./apps/web ./apps/web

# Run DB generation and build
RUN pnpm run db:generate
RUN pnpm run build:web

# Expose port
EXPOSE 3000

# Start app
CMD ["pnpm", "run", "start:web"]
